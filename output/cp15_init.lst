


ARM Macro Assembler    Page 1 


    1 00000000         ; ------------------------------------------------------
                       ----------------------
    2 00000000         ;         ATMEL Microcontroller Software Support 
    3 00000000         ; ------------------------------------------------------
                       ----------------------
    4 00000000         ; Copyright (c) 2008, Atmel Corporation
    5 00000000         ;
    6 00000000         ; All rights reserved.
    7 00000000         ;
    8 00000000         ; Redistribution and use in source and binary forms, wit
                       h or without
    9 00000000         ; modification, are permitted provided that the followin
                       g conditions are met:
   10 00000000         ;
   11 00000000         ; - Redistributions of source code must retain the above
                        copyright notice,
   12 00000000         ; this list of conditions and the disclaimer below.
   13 00000000         ;
   14 00000000         ; Atmel's name may not be used to endorse or promote pro
                       ducts derived from
   15 00000000         ; this software without specific prior written permissio
                       n.
   16 00000000         ;
   17 00000000         ; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY ATMEL "AS IS"
                        AND ANY EXPRESS OR
   18 00000000         ; IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
                        IMPLIED WARRANTIES OF
   19 00000000         ; MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
                       NON-INFRINGEMENT ARE
   20 00000000         ; DISCLAIMED. IN NO EVENT SHALL ATMEL BE LIABLE FOR ANY 
                       DIRECT, INDIRECT,
   21 00000000         ; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAG
                       ES (INCLUDING, BUT NOT
   22 00000000         ; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICE
                       S; LOSS OF USE, DATA,
   23 00000000         ; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED A
                       ND ON ANY THEORY OF
   24 00000000         ; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR T
                       ORT (INCLUDING
   25 00000000         ; NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
                        USE OF THIS SOFTWARE,
   26 00000000         ; EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   27 00000000         ; ------------------------------------------------------
                       ----------------------
   28 00000000         ;
   29 00000000         
   30 00000000                 AREA             cp15, CODE
   31 00000000         
   32 00000000         ;-------------------------------------------------------
                       -----------------------
   33 00000000         ;         Headers
   34 00000000         ;-------------------------------------------------------
                       -----------------------
   35 00000000         
   36 00000000         ;-------------------------------------------------------
                       -----------------------
   37 00000000         ; Functions to access CP15 coprocessor register
   38 00000000         ;-------------------------------------------------------
                       -----------------------



ARM Macro Assembler    Page 2 


   39 00000000         ; c0
   40 00000000                 EXPORT           CP15_ReadID
   41 00000000                 EXPORT           CP15_ReaDcacheType
   42 00000000                 EXPORT           CP15_ReadTCMStatus
   43 00000000         ; c1        
   44 00000000                 EXPORT           CP15_ReadControl
   45 00000000                 EXPORT           CP15_WriteControl
   46 00000000         ; c2        
   47 00000000                 EXPORT           CP15_ReadTTB
   48 00000000                 EXPORT           CP15_WriteTTB
   49 00000000         ; c3        
   50 00000000                 EXPORT           CP15_ReadDomainAccessControl
   51 00000000                 EXPORT           CP15_WriteDomainAccessControl
   52 00000000         ; c7        
   53 00000000                 EXPORT           CP15_InvalidateIDcache
   54 00000000                 EXPORT           CP15_InvalidateDcache
   55 00000000                 EXPORT           CP15_InvalidateIcache
   56 00000000                 EXPORT           CP15_PrefetchIcacheLine
   57 00000000                 EXPORT           CP15_TestCleanInvalidateDcache
   58 00000000                 EXPORT           CP15_CleanInvalidateDcacheIndex
   59 00000000                 EXPORT           CP15_DrainWriteBuffer
   60 00000000                 EXPORT           CP15_WaitForInterrupt
   61 00000000         ; c8        
   62 00000000                 EXPORT           CP15_InvalidateTLB
   63 00000000                 EXPORT           CP15_InvalidateTLBMVA
   64 00000000                 EXPORT           CP15_InvalidateITLB
   65 00000000                 EXPORT           CP15_InvalidateITLBMVA
   66 00000000                 EXPORT           CP15_InvalidateDTLB
   67 00000000                 EXPORT           CP15_InvalidateDTLBMVA
   68 00000000         ; c9        
   69 00000000                 EXPORT           CP15_ReadDcacheLockdown
   70 00000000                 EXPORT           CP15_WriteDcacheLockdown
   71 00000000                 EXPORT           CP15_ReadIcacheLockdown
   72 00000000                 EXPORT           CP15_WriteIcacheLockdown
   73 00000000                 EXPORT           CP15_ReadTLBLockdown
   74 00000000                 EXPORT           CP15_WriteTLBLockdown
   75 00000000         ; c13        
   76 00000000                 EXPORT           CP15_ReadTLBLockdown
   77 00000000                 EXPORT           CP15_WriteTLBLockdown
   78 00000000         ; c13        
   79 00000000                 EXPORT           CP15_ReadFCSE_PID
   80 00000000                 EXPORT           CP15_WriteFCSE_PID
   81 00000000         
   82 00000000         ;-------------------------------------------------------
                       -----------------------
   83 00000000         ; c0
   84 00000000         ; Register c0 accesses the ID Register, Cache Type Regis
                       ter, and TCM Status Registers.
   85 00000000         ; Reading from this register returns the device ID, the 
                       cache type, or the TCM status
   86 00000000         ; depending on the value of Opcode_2 used:
   87 00000000         ; Opcode_2 = 0 ID value.
   88 00000000         ; Opcode_2 = 1 instruction and data cache type.
   89 00000000         ; Opcode_2 = 2 TCM status.
   90 00000000         ;-------------------------------------------------------
                       -----------------------
   91 00000000         
   92 00000000         ; C0 read ID
   93 00000000         CP15_ReadID



ARM Macro Assembler    Page 3 


   94 00000000 E3A00000        mov              r0, #0
   95 00000004 EE100F10        mrc              p15, 0, r0, c0, c0, 0
   96 00000008 E12FFF1E        bx               lr
   97 0000000C         
   98 0000000C         ; C0 read Cache Type
   99 0000000C         CP15_ReaDcacheType
  100 0000000C E3A00000        mov              r0, #0
  101 00000010 EE100F30        mrc              p15, 0, r0, c0, c0, 1
  102 00000014 E12FFF1E        bx               lr
  103 00000018         
  104 00000018         ; C0 read TCM status
  105 00000018         CP15_ReadTCMStatus
  106 00000018 E3A00000        mov              r0, #0
  107 0000001C EE100F50        mrc              p15, 0, r0, c0, c0, 2
  108 00000020 E12FFF1E        bx               lr
  109 00000024         
  110 00000024         ;-------------------------------------------------------
                       -----------------------
  111 00000024         ; Control Register c1
  112 00000024         ; Register c1 is the Control Register for the ARM926EJ-S
                        processor.
  113 00000024         ; This register specifies the configuration used to enab
                       le and disable the
  114 00000024         ; caches and MMU. It is recommended that you access this
                        register using a
  115 00000024         ; read-modify-write sequence.
  116 00000024         ;-------------------------------------------------------
                       -----------------------
  117 00000024         ; CP15 Read Control Register
  118 00000024         CP15_ReadControl
  119 00000024 E3A00000        mov              r0, #0
  120 00000028 EE110F10        mrc              p15, 0, r0, c1, c0, 0
  121 0000002C E12FFF1E        bx               lr
  122 00000030         
  123 00000030         ; CP15 Write Control Register
  124 00000030         CP15_WriteControl
  125 00000030 EE010F10        mcr              p15, 0, r0, c1, c0, 0
  126 00000034 E1A00000        nop
  127 00000038 E1A00000        nop
  128 0000003C E1A00000        nop
  129 00000040 E1A00000        nop
  130 00000044 E1A00000        nop
  131 00000048 E1A00000        nop
  132 0000004C E1A00000        nop
  133 00000050 E1A00000        nop
  134 00000054 E12FFF1E        bx               lr
  135 00000058         
  136 00000058         ;-------------------------------------------------------
                       -----------------------
  137 00000058         ; CP15 Translation Table Base Register c2
  138 00000058         ; Register c2 is the Translation Table Base Register (TT
                       BR), for the base
  139 00000058         ; address of the first-level translation table.
  140 00000058         ; Reading from c2 returns the pointer to the currently a
                       ctive first-level
  141 00000058         ; translation table in bits [31:14] and an Unpredictable
                        value in bits [13:0].
  142 00000058         ; Writing to register c2 updates the pointer to the firs
                       t-level translation



ARM Macro Assembler    Page 4 


  143 00000058         ; table from the value in bits [31:14] of the written va
                       lue. Bits [13:0]
  144 00000058         ; Should Be Zero.
  145 00000058         ; You can use the following instructions to access the T
                       TBR:
  146 00000058         ; Read TTBR  : MRC p15, 0, <Rd>, c2, c0, 0
  147 00000058         ; Write TTBR : MCR p15, 0, <Rd>, c2, c0, 0
  148 00000058         ;-------------------------------------------------------
                       -----------------------
  149 00000058         CP15_ReadTTB
  150 00000058 E3A00000        mov              r0, #0
  151 0000005C EE120F10        mrc              p15, 0, r0, c2, c0, 0
  152 00000060 E12FFF1E        bx               lr
  153 00000064         
  154 00000064         CP15_WriteTTB
  155 00000064 EE020F10        mcr              p15, 0, r0, c2, c0, 0
  156 00000068 E1A00000        nop
  157 0000006C E1A00000        nop
  158 00000070 E1A00000        nop
  159 00000074 E1A00000        nop
  160 00000078 E1A00000        nop
  161 0000007C E1A00000        nop
  162 00000080 E1A00000        nop
  163 00000084 E1A00000        nop
  164 00000088 E12FFF1E        bx               lr
  165 0000008C         
  166 0000008C         ;-------------------------------------------------------
                       -----------------------
  167 0000008C         ; Domain Access Control Register c3
  168 0000008C         ; Read domain access permissions  : MRC p15, 0, <Rd>, c3
                       , c0, 0
  169 0000008C         ; Write domain access permissions : MCR p15, 0, <Rd>, c3
                       , c0, 0
  170 0000008C         ;-------------------------------------------------------
                       -----------------------
  171 0000008C         CP15_ReadDomainAccessControl
  172 0000008C E3A00000        mov              r0, #0
  173 00000090 EE130F10        mrc              p15, 0, r0, c3, c0, 0
  174 00000094 E12FFF1E        bx               lr
  175 00000098         
  176 00000098         CP15_WriteDomainAccessControl
  177 00000098 EE030F10        mcr              p15, 0, r0, c3, c0, 0
  178 0000009C E1A00000        nop
  179 000000A0 E1A00000        nop
  180 000000A4 E1A00000        nop
  181 000000A8 E1A00000        nop
  182 000000AC E1A00000        nop
  183 000000B0 E1A00000        nop
  184 000000B4 E1A00000        nop
  185 000000B8 E1A00000        nop
  186 000000BC E12FFF1E        bx               lr
  187 000000C0         
  188 000000C0         ;-------------------------------------------------------
                       -----------------------
  189 000000C0         ; Fault Status Registers Register c5
  190 000000C0         ; Register c5 accesses the Fault Status Registers (FSRs)
                       . The FSRs contain the source of
  191 000000C0         ; the last instruction or data fault. The instruction-si
                       de FSR is intended for debug



ARM Macro Assembler    Page 5 


  192 000000C0         ; purposes only. The FSR is updated for alignment faults
                       , and external aborts that occur
  193 000000C0         ; while the MMU is disabled.
  194 000000C0         ; The FSR accessed is determined by the value of the Opc
                       ode_2 field:
  195 000000C0         ; Opcode_2 = 0  Data Fault Status Register (DFSR).
  196 000000C0         ; Opcode_2 = 1  Instruction Fault Status Register (IFSR)
                       .
  197 000000C0         ; The fault type encoding is listed in Table 3-9 on page
                        3-22.
  198 000000C0         ; You can access the FSRs using the following instructio
                       ns:
  199 000000C0         ; MRC p15, 0, <Rd>, c5, c0, 0 ;read DFSR
  200 000000C0         ; MCR p15, 0, <Rd>, c5, c0, 0 ;write DFSR
  201 000000C0         ; MRC p15, 0, <Rd>, c5, c0, 1 ;read IFSR
  202 000000C0         ; MCR p15, 0, <Rd>, c5, c0, 1 ;write IFSR
  203 000000C0         ;-------------------------------------------------------
                       -----------------------
  204 000000C0         
  205 000000C0         CP15_ReadDFSR
  206 000000C0 E3A00000        mov              r0, #0
  207 000000C4 EE150F10        mrc              p15, 0, r0, c5, c0, 0
  208 000000C8 E12FFF1E        bx               lr
  209 000000CC         
  210 000000CC         CP15_writeDFSR
  211 000000CC EE050F10        mcr              p15, 0, r0, c5, c0, 0
  212 000000D0 E12FFF1E        bx               lr
  213 000000D4         
  214 000000D4         CP15_ReadIFSR
  215 000000D4 E3A00000        mov              r0, #0
  216 000000D8 EE150F30        mrc              p15, 0, r0, c5, c0, 1
  217 000000DC E12FFF1E        bx               lr
  218 000000E0         
  219 000000E0         CP15_WriteIFSR
  220 000000E0 EE050F30        mcr              p15, 0, r0, c5, c0, 1
  221 000000E4 E12FFF1E        bx               lr
  222 000000E8         
  223 000000E8         ;-------------------------------------------------------
                       -----------------------
  224 000000E8         ; Fault Address Register c6
  225 000000E8         ; Register c6 accesses the Fault Address Register (FAR).
                        The FAR contains the Modified
  226 000000E8         ; Virtual Address of the access being attempted when a D
                       ata Abort occurred. The FAR is
  227 000000E8         ; only updated for Data Aborts, not for Prefetch Aborts.
                        The FAR is updated for
  228 000000E8         ; alignment faults, and external aborts that occur while
                        the MMU is disabled.
  229 000000E8         ; You can use the following instructions to access the F
                       AR:
  230 000000E8         ; MRC p15, 0, <Rd>, c6, c0, 0 ; read FAR
  231 000000E8         ; MCR p15, 0, <Rd>, c6, c0, 0 ; write FAR
  232 000000E8         ;-------------------------------------------------------
                       -----------------------
  233 000000E8         CP15_ReadFAR
  234 000000E8 E3A00000        mov              r0, #0
  235 000000EC EE160F10        mrc              p15, 0, r0, c6, c0, 0
  236 000000F0 E12FFF1E        bx               lr
  237 000000F4         



ARM Macro Assembler    Page 6 


  238 000000F4         CP15_writeFAR
  239 000000F4 EE060F10        mcr              p15, 0, r0, c6, c0, 0
  240 000000F8 E12FFF1E        bx               lr
  241 000000FC         
  242 000000FC         ;-------------------------------------------------------
                       -----------------------
  243 000000FC         ; Control functions caches and the write buffer c7
  244 000000FC         ; Register c7 controls the caches and the write buffer. 
                       The function of each cache
  245 000000FC         ; operation is selected by the Opcode_2 and CRm fields i
                       n the MCR instruction used to
  246 000000FC         ; write to CP15 c7. Writing other Opcode_2 or CRm values
                        is Unpredictable.
  247 000000FC         ; Reading from CP15 c7 is Unpredictable, with the except
                       ion of the two test and clean
  248 000000FC         ; operations (see Table 2-18 on page 2-21 and Test and c
                       lean operations on page 2-23).
  249 000000FC         ; You can use the following instruction to write to c7:
  250 000000FC         ; MCR p15, <Opcode_1>, <Rd>, <CRn>, <CRm>, <Opcode_2>
  251 000000FC         ;-------------------------------------------------------
                       -----------------------
  252 000000FC         ; Invalidate Icache and Dcache                        MC
                       R p15, 0, <Rd>, c7, c7, 0
  253 000000FC         ; Invalidate Icache                                   MC
                       R p15, 0, <Rd>, c7, c5, 0
  254 000000FC         ; Invalidate Icache single entry (MVA) MVA            MC
                       R p15, 0, <Rd>, c7, c5, 1
  255 000000FC         ; Invalidate Icache single entry (Set/Way) Set/Way    MC
                       R p15, 0, <Rd>, c7, c5, 2
  256 000000FC         ; Prefetch Icache line (MVA) MVA                      MC
                       R p15, 0, <Rd>, c7, c13, 1
  257 000000FC         ; Invalidate Dcache                                   MC
                       R p15, 0, <Rd>, c7, c6, 0
  258 000000FC         ; Invalidate Dcache single entry (MVA) MVA            MC
                       R p15, 0, <Rd>, c7, c6, 1
  259 000000FC         ; Invalidate Dcache single entry (Set/Way) Set/Way    MC
                       R p15, 0, <Rd>, c7, c6, 2
  260 000000FC         ; Clean Dcache single entry (MVA) MVA                 MC
                       R p15, 0, <Rd>, c7, c10, 1
  261 000000FC         ; Clean Dcache single entry (Set/Way) Set/Way         MC
                       R p15, 0, <Rd>, c7, c10, 2
  262 000000FC         ; Test and clean Dcache -                             MR
                       C p15, 0, <Rd>, c7, c10, 3
  263 000000FC         ; Clean and invalidate Dcache entry (MVA)  MVA        MC
                       R p15, 0, <Rd>, c7, c14, 1
  264 000000FC         ; Clean and invalidate Dcache entry (Set/Way) Set/Way MC
                       R p15, 0, <Rd>, c7, c14, 2
  265 000000FC         ; Test, clean, and invalidate Dcache -                MR
                       C p15, 0, <Rd>, c7, c14, 3
  266 000000FC         ; Drain write buffer SBZ                              MC
                       R p15, 0, <Rd>, c7, c10, 4
  267 000000FC         ; Wait for interrupt SBZ                              MC
                       R p15, 0, <Rd>, c7, c0, 4
  268 000000FC         ;-------------------------------------------------------
                       -----------------------
  269 000000FC         
  270 000000FC         ; Invalidate Icache and Dcache
  271 000000FC         CP15_InvalidateIDcache
  272 000000FC E3A00000        mov              r0, #0



ARM Macro Assembler    Page 7 


  273 00000100 EE070F17        mcr              p15, 0, r0, c7, c7, 0
  274 00000104 E1A00000        nop
  275 00000108 E1A00000        nop
  276 0000010C E1A00000        nop
  277 00000110 E1A00000        nop
  278 00000114 E1A00000        nop
  279 00000118 E1A00000        nop
  280 0000011C E1A00000        nop
  281 00000120 E1A00000        nop
  282 00000124 E12FFF1E        bx               lr
  283 00000128         
  284 00000128         ; Invalidate Icache
  285 00000128         CP15_InvalidateIcache
  286 00000128 E3A00000        mov              r0, #0
  287 0000012C EE070F15        mcr              p15, 0, r0, c7, c5, 0
  288 00000130 E1A00000        nop
  289 00000134 E1A00000        nop
  290 00000138 E1A00000        nop
  291 0000013C E1A00000        nop
  292 00000140 E1A00000        nop
  293 00000144 E1A00000        nop
  294 00000148 E1A00000        nop
  295 0000014C E1A00000        nop
  296 00000150 E12FFF1E        bx               lr
  297 00000154         
  298 00000154         ; Invalidate Dcache
  299 00000154         CP15_InvalidateDcache
  300 00000154 E3A00000        mov              r0, #0
  301 00000158 EE070F16        mcr              p15, 0, r0, c7, c6, 0
  302 0000015C E1A00000        nop
  303 00000160 E1A00000        nop
  304 00000164 E1A00000        nop
  305 00000168 E1A00000        nop
  306 0000016C E1A00000        nop
  307 00000170 E1A00000        nop
  308 00000174 E1A00000        nop
  309 00000178 E1A00000        nop
  310 0000017C E12FFF1E        bx               lr
  311 00000180         
  312 00000180         ;-------------------------------------------------------
                       -----------------------
  313 00000180         ; CP15 Prefetch Icache line c7
  314 00000180         ; Performs an Icache lookup of the specified modified vi
                       rtual address.
  315 00000180         ; If the cache misses, and the region is cacheable, a li
                       nefill is performed.
  316 00000180         ; Prefetch Icache line (MVA): MCR p15, 0, <Rd>, c7, c13,
                        1
  317 00000180         ;-------------------------------------------------------
                       -----------------------
  318 00000180         CP15_PrefetchIcacheLine
  319 00000180 EE070F3D        mcr              p15, 0, r0, c7, c13, 1
  320 00000184 E12FFF1E        bx               lr
  321 00000188         
  322 00000188         ;-------------------------------------------------------
                       -----------------------
  323 00000188         ; CP15 Test, clean, and invalidate Dcache c7
  324 00000188         ; As for test and clean, except that when the entire cac
                       he has 



ARM Macro Assembler    Page 8 


  325 00000188         ; been tested and cleaned, it is invalidated.
  326 00000188         ;-------------------------------------------------------
                       -----------------------
  327 00000188         CP15_TestCleanInvalidateDcache
  328 00000188 EE170F7E        mrc              p15, 0, r0, c7, c14, 3
  329 0000018C 1AFFFFFE        bne              CP15_TestCleanInvalidateDcache
  330 00000190 E12FFF1E        bx               lr
  331 00000194         
  332 00000194         CP15_CleanInvalidateDcacheIndex
  333 00000194         ;r0=index
  334 00000194 EE070F5E        mcr              p15,0,r0,c7,c14,2
  335 00000198 E12FFF1E        bx               lr
  336 0000019C         
  337 0000019C         ;-------------------------------------------------------
                       -----------------------
  338 0000019C         ; CP15 Drain write buffer c7
  339 0000019C         ; This instruction acts as an explicit memory barrier. I
                       t drains 
  340 0000019C         ; the contents of the write buffers of all memory stores
                        
  341 0000019C         ; occurring in program order before this instruction is 
                       
  342 0000019C         ; completed. No instructions occurring in program order 
                       
  343 0000019C         ; after this instruction are executed until it completes
                       . This 
  344 0000019C         ; can be used when timing of specific stores to the leve
                       l two 
  345 0000019C         ; memory system has to be controlled (for example, when 
                       a 
  346 0000019C         ; store to an interrupt acknowledge location has to comp
                       lete 
  347 0000019C         ; before interrupts are enabled).
  348 0000019C         ;-------------------------------------------------------
                       -----------------------
  349 0000019C         CP15_DrainWriteBuffer
  350 0000019C E3A00000        mov              r0, #0
  351 000001A0 EE070F9A        mcr              p15, 0, r0, c7, c10, 4
  352 000001A4 E12FFF1E        bx               lr
  353 000001A8         
  354 000001A8         ;-------------------------------------------------------
                       -----------------------
  355 000001A8         ; CP15 Wait For Interrupt operation c7
  356 000001A8         ; The purpose of the Wait For Interrupt operation is to 
                       put the processor in
  357 000001A8         ; to a low power state.
  358 000001A8         ; This puts the processor into a low-power state and sto
                       ps it executing more
  359 000001A8         ; instructions until an interrupt, or debug request occu
                       rs, regardless of
  360 000001A8         ; whether the interrupts are disabled by the masks in th
                       e CPSR.
  361 000001A8         ; When an interrupt does occur, the mcr instruction comp
                       letes and the IRQ or
  362 000001A8         ; FIQ handler is entered as normal. The return link in r
                       14_irq or r14_fiq
  363 000001A8         ; contains the address of the mcr instruction plus 8, so
                        that the normal
  364 000001A8         ; instruction used for interrupt return (SUBS PC,R14,#4)



ARM Macro Assembler    Page 9 


                        returns to the
  365 000001A8         ; instruction following the mcr.
  366 000001A8         ; Wait For Interrupt : MCR p15, 0, <Rd>, c7, c0, 4
  367 000001A8         ;-------------------------------------------------------
                       -----------------------
  368 000001A8         CP15_WaitForInterrupt
  369 000001A8 E3A00000        mov              r0, #0
  370 000001AC EE070F90        mcr              p15, 0, r0, c7, c0, 4
  371 000001B0 E12FFF1E        bx               lr
  372 000001B4         
  373 000001B4         ;-------------------------------------------------------
                       -----------------------
  374 000001B4         ; Translation Lookaside Buffer (TLB) : c8
  375 000001B4         ; This is a write-only register used to control the Tran
                       slation Lookaside Buffer (TLB).
  376 000001B4         ; There is a single TLB used to hold entries for both da
                       ta and instructions. The TLB is
  377 000001B4         ; divided into two parts:
  378 000001B4         ; • a set-associative part
  379 000001B4         ; • a fully-associative part.
  380 000001B4         ; The fully-associative part (also referred to as the lo
                       ckdown part of the TLB) is used to
  381 000001B4         ; store entries to be locked down. Entries held in the l
                       ockdown part of the TLB are
  382 000001B4         ; preserved during an invalidate TLB operation. Entries 
                       can be removed from the
  383 000001B4         ; lockdown TLB using an invalidate TLB single entry oper
                       ation.
  384 000001B4         ; Six TLB operations are defined, and the function to be
                        performed is selected by the
  385 000001B4         ; Opcode_2 and CRm fields in the MCR instruction used to
                        write CP15 c8. Writing other
  386 000001B4         ; Opcode_2 or CRm values is Unpredictable. Reading from 
                       this register is Unpredictable.
  387 000001B4         ;-------------------------------------------------------
                       -----------------------
  388 000001B4         ; Invalidate TLB                                 MCR p15
                       , 0, <Rd>, c8, c7, 0
  389 000001B4         ; Invalidate TLB single entry (MVA)              MCR p15
                       , 0, <Rd>, c8, c7, 1
  390 000001B4         ; Invalidate instruction TLB                     MCR p15
                       , 0, <Rd>, c8, c5, 0
  391 000001B4         ; Invalidate instruction TLB single entry (MVA)  MCR p15
                       , 0, <Rd>, c8, c5, 1
  392 000001B4         ; Invalidate data TLB                            MCR p15
                       , 0, <Rd>, c8, c6, 0
  393 000001B4         ; Invalidate data TLB single entry (MVA)         MCR p15
                       , 0, <Rd>, c8, c6, 1
  394 000001B4         ;-------------------------------------------------------
                       -----------------------
  395 000001B4         
  396 000001B4         CP15_InvalidateTLB
  397 000001B4 E3A00000        mov              r0, #0
  398 000001B8 EE080F17        mcr              p15, 0, r0, c8, c7, 0
  399 000001BC E12FFF1E        bx               lr
  400 000001C0         
  401 000001C0         CP15_InvalidateTLBMVA
  402 000001C0 EE080F37        mcr              p15, 0, r0, c8, c7, 1
  403 000001C4 E12FFF1E        bx               lr



ARM Macro Assembler    Page 10 


  404 000001C8         
  405 000001C8         CP15_InvalidateITLB
  406 000001C8 E3A00000        mov              r0, #0
  407 000001CC EE080F15        mcr              p15, 0, r0, c8, c5, 0
  408 000001D0 E12FFF1E        bx               lr
  409 000001D4         
  410 000001D4         CP15_InvalidateITLBMVA
  411 000001D4 EE080F35        mcr              p15, 0, r0, c8, c5, 1
  412 000001D8 E12FFF1E        bx               lr
  413 000001DC         
  414 000001DC         CP15_InvalidateDTLB
  415 000001DC E3A00000        mov              r0, #0
  416 000001E0 EE080F16        mcr              p15, 0, r0, c8, c6, 0
  417 000001E4 E12FFF1E        bx               lr
  418 000001E8         
  419 000001E8         CP15_InvalidateDTLBMVA
  420 000001E8 EE080F36        mcr              p15, 0, r0, c8, c6, 1
  421 000001EC E12FFF1E        bx               lr
  422 000001F0         
  423 000001F0         ;-------------------------------------------------------
                       -----------------------
  424 000001F0         ; Cache Lockdown Register c9
  425 000001F0         ; The Cache Lockdown Register uses a cache-way-based loc
                       king scheme (Format C) that
  426 000001F0         ; enables you to control each cache way independently.
  427 000001F0         ; These registers enable you to control which cache ways
                        of the four-way cache are used
  428 000001F0         ; for the allocation on a linefill. When the registers a
                       re defined, subsequent linefills are
  429 000001F0         ; only placed in the specified target cache way. This gi
                       ves you some control over the
  430 000001F0         ; cache pollution caused by particular applications, and
                        provides a traditional lockdown
  431 000001F0         ; operation for locking critical code into the cache.
  432 000001F0         ;-------------------------------------------------------
                       -----------------------
  433 000001F0         ; Read Dcache Lockdown Register   MRC p15,0,<Rd>,c9,c0,0
                       
  434 000001F0         ; Write Dcache Lockdown Register  MCR p15,0,<Rd>,c9,c0,0
                       
  435 000001F0         ; Read Icache Lockdown Register   MRC p15,0,<Rd>,c9,c0,1
                       
  436 000001F0         ; Write Icache Lockdown Register  MCR p15,0,<Rd>,c9,c0,1
                       
  437 000001F0         ;-------------------------------------------------------
                       -----------------------
  438 000001F0         
  439 000001F0         CP15_ReadDcacheLockdown
  440 000001F0 E3A00000        mov              r0, #0
  441 000001F4 EE190F10        mrc              p15, 0, r0, c9, c0, 0
  442 000001F8 E12FFF1E        bx               lr
  443 000001FC         
  444 000001FC         CP15_WriteDcacheLockdown
  445 000001FC EE090F10        mcr              p15, 0, r0, c9, c0, 0
  446 00000200 E1A00000        nop
  447 00000204 E1A00000        nop
  448 00000208 E1A00000        nop
  449 0000020C E1A00000        nop
  450 00000210 E1A00000        nop



ARM Macro Assembler    Page 11 


  451 00000214 E1A00000        nop
  452 00000218 E1A00000        nop
  453 0000021C E1A00000        nop
  454 00000220 E12FFF1E        bx               lr
  455 00000224         
  456 00000224         CP15_ReadIcacheLockdown
  457 00000224 E3A00000        mov              r0, #0
  458 00000228 EE190F30        mrc              p15, 0, r0, c9, c0, 1
  459 0000022C E12FFF1E        bx               lr
  460 00000230         
  461 00000230         CP15_WriteIcacheLockdown
  462 00000230 EE090F30        mcr              p15, 0, r0, c9, c0, 1
  463 00000234 E1A00000        nop
  464 00000238 E1A00000        nop
  465 0000023C E1A00000        nop
  466 00000240 E1A00000        nop
  467 00000244 E1A00000        nop
  468 00000248 E1A00000        nop
  469 0000024C E1A00000        nop
  470 00000250 E1A00000        nop
  471 00000254 E12FFF1E        bx               lr
  472 00000258         
  473 00000258         ;-------------------------------------------------------
                       -----------------------
  474 00000258         ; TLB Lockdown Register c10
  475 00000258         ; The TLB Lockdown Register controls where hardware page
                        table walks place the
  476 00000258         ; TLB entry, in the set associative region or the lockdo
                       wn region of the TLB,
  477 00000258         ; and if in the lockdown region, which entry is written.
                        The lockdown region
  478 00000258         ; of the TLB contains eight entries. See TLB structure f
                       or a description of
  479 00000258         ; the structure of the TLB.
  480 00000258         ;-------------------------------------------------------
                       -----------------------
  481 00000258         ; Read data TLB lockdown victim    MRC p15,0,<Rd>,c10,c0
                       ,0
  482 00000258         ; Write data TLB lockdown victim   MCR p15,0,<Rd>,c10,c0
                       ,0
  483 00000258         ;-------------------------------------------------------
                       -----------------------
  484 00000258         CP15_ReadTLBLockdown
  485 00000258 E3A00000        mov              r0, #0
  486 0000025C EE1A0F10        mrc              p15, 0, r0, c10, c0, 0
  487 00000260 E12FFF1E        bx               lr
  488 00000264         
  489 00000264         CP15_WriteTLBLockdown
  490 00000264 EE0A0F10        mcr              p15, 0, r0, c10, c0, 0
  491 00000268 E1A00000        nop
  492 0000026C E1A00000        nop
  493 00000270 E1A00000        nop
  494 00000274 E1A00000        nop
  495 00000278 E1A00000        nop
  496 0000027C E1A00000        nop
  497 00000280 E1A00000        nop
  498 00000284 E1A00000        nop
  499 00000288 E12FFF1E        bx               lr
  500 0000028C         



ARM Macro Assembler    Page 12 


  501 0000028C         ;-------------------------------------------------------
                       -----------------------
  502 0000028C         ; Register c13 accesses the process identifier registers
                       . The register accessed depends on
  503 0000028C         ; the value of the Opcode_2 field:
  504 0000028C         ; Opcode_2 = 0  Selects the Fast Context Switch Extensio
                       n (FCSE) Process Identifier (PID) Register.
  505 0000028C         ; Opcode_2 = 1  Selects the Context ID Register.
  506 0000028C         ;-------------------------------------------------------
                       -----------------------
  507 0000028C         ; FCSE PID Register
  508 0000028C         ; Addresses issued by the ARM9EJ-S core in the range 0 t
                       o 32MB are translated in
  509 0000028C         ; accordance with the value contained in this register. 
                       Address A becomes A + (FCS
  510 0000028C         ; PID x 32MB). It is this modified address that is seen 
                       by the caches, MMU, and TC
  511 0000028C         ; interface. Addresses above 32MB are not modified. The 
                       FCSE PID is a seven-bit fie
  512 0000028C         ; enabling 128 x 32MB processes to be mapped.
  513 0000028C         ; If the FCSE PID is 0, there is a flat mapping between 
                       the virtual addresses output by
  514 0000028C         ; ARM9EJ-S core and the modified virtual addresses used 
                       by the caches, MMU, and
  515 0000028C         ; TCM interface. The FCSE PID is set to 0 at system rese
                       t.
  516 0000028C         ; If the MMU is disabled, then no FCSE address translati
                       on occurs.
  517 0000028C         ; FCSE translation is not applied for addresses used for
                        entry based cache or TLB
  518 0000028C         ; maintenance operations. For these operations VA = MVA.
                       
  519 0000028C         ;-------------------------------------------------------
                       -----------------------
  520 0000028C         ; Read FCSE PID  MRC p15,0,<Rd>,c13,c0, 0
  521 0000028C         ; Write FCSE PID MCR p15,0,<Rd>,c13,c0, 0
  522 0000028C         ;-------------------------------------------------------
                       -----------------------
  523 0000028C         ; Context ID Register
  524 0000028C         ; The Context ID Register provides a mechanism to allow 
                       real-time trace tools to identify
  525 0000028C         ; the currently executing process in multi-tasking envir
                       onments.
  526 0000028C         ; The contents of this register are replicated on the ET
                       MPROCID pins of the
  527 0000028C         ; ARM926EJ-S processor. ETMPROCIDWR is pulsed when a wri
                       te occurs to the
  528 0000028C         ; Context ID Register.
  529 0000028C         ;-------------------------------------------------------
                       -----------------------
  530 0000028C         ; Read context ID  MRC p15,0,<Rd>,c13,c0, 1
  531 0000028C         ; Write context ID MCR p15,0,<Rd>,c13,c0, 1
  532 0000028C         ;-------------------------------------------------------
                       -----------------------
  533 0000028C         CP15_ReadFCSE_PID
  534 0000028C E3A00000        mov              r0, #0
  535 00000290 EE1D0F10        mrc              p15, 0, r0, c13, c0, 0
  536 00000294 E12FFF1E        bx               lr
  537 00000298         



ARM Macro Assembler    Page 13 


  538 00000298         CP15_WriteFCSE_PID
  539 00000298 EE0D0F10        mcr              p15, 0, r0, c13, c0, 0
  540 0000029C E12FFF1E        bx               lr
  541 000002A0                 END
Command Line: --debug --xref --cpu=ARM926EJ-S --apcs=interwork --depend=.\outpu
t\cp15_init.d -o.\output\cp15_init.o -IC:\Keil\ARM\CMSIS\Include -IC:\Keil\ARM\
INC\Atmel\SAM9M10 --list=.\output\cp15_init.lst cp15_init.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

CP15_CleanInvalidateDcacheIndex 00000194

Symbol: CP15_CleanInvalidateDcacheIndex
   Definitions
      At line 332 in file cp15_init.s
   Uses
      At line 58 in file cp15_init.s
Comment: CP15_CleanInvalidateDcacheIndex used once
CP15_DrainWriteBuffer 0000019C

Symbol: CP15_DrainWriteBuffer
   Definitions
      At line 349 in file cp15_init.s
   Uses
      At line 59 in file cp15_init.s
Comment: CP15_DrainWriteBuffer used once
CP15_InvalidateDTLB 000001DC

Symbol: CP15_InvalidateDTLB
   Definitions
      At line 414 in file cp15_init.s
   Uses
      At line 66 in file cp15_init.s
Comment: CP15_InvalidateDTLB used once
CP15_InvalidateDTLBMVA 000001E8

Symbol: CP15_InvalidateDTLBMVA
   Definitions
      At line 419 in file cp15_init.s
   Uses
      At line 67 in file cp15_init.s
Comment: CP15_InvalidateDTLBMVA used once
CP15_InvalidateDcache 00000154

Symbol: CP15_InvalidateDcache
   Definitions
      At line 299 in file cp15_init.s
   Uses
      At line 54 in file cp15_init.s
Comment: CP15_InvalidateDcache used once
CP15_InvalidateIDcache 000000FC

Symbol: CP15_InvalidateIDcache
   Definitions
      At line 271 in file cp15_init.s
   Uses
      At line 53 in file cp15_init.s
Comment: CP15_InvalidateIDcache used once
CP15_InvalidateITLB 000001C8

Symbol: CP15_InvalidateITLB
   Definitions
      At line 405 in file cp15_init.s
   Uses
      At line 64 in file cp15_init.s
Comment: CP15_InvalidateITLB used once
CP15_InvalidateITLBMVA 000001D4

Symbol: CP15_InvalidateITLBMVA



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 410 in file cp15_init.s
   Uses
      At line 65 in file cp15_init.s
Comment: CP15_InvalidateITLBMVA used once
CP15_InvalidateIcache 00000128

Symbol: CP15_InvalidateIcache
   Definitions
      At line 285 in file cp15_init.s
   Uses
      At line 55 in file cp15_init.s
Comment: CP15_InvalidateIcache used once
CP15_InvalidateTLB 000001B4

Symbol: CP15_InvalidateTLB
   Definitions
      At line 396 in file cp15_init.s
   Uses
      At line 62 in file cp15_init.s
Comment: CP15_InvalidateTLB used once
CP15_InvalidateTLBMVA 000001C0

Symbol: CP15_InvalidateTLBMVA
   Definitions
      At line 401 in file cp15_init.s
   Uses
      At line 63 in file cp15_init.s
Comment: CP15_InvalidateTLBMVA used once
CP15_PrefetchIcacheLine 00000180

Symbol: CP15_PrefetchIcacheLine
   Definitions
      At line 318 in file cp15_init.s
   Uses
      At line 56 in file cp15_init.s
Comment: CP15_PrefetchIcacheLine used once
CP15_ReaDcacheType 0000000C

Symbol: CP15_ReaDcacheType
   Definitions
      At line 99 in file cp15_init.s
   Uses
      At line 41 in file cp15_init.s
Comment: CP15_ReaDcacheType used once
CP15_ReadControl 00000024

Symbol: CP15_ReadControl
   Definitions
      At line 118 in file cp15_init.s
   Uses
      At line 44 in file cp15_init.s
Comment: CP15_ReadControl used once
CP15_ReadDFSR 000000C0

Symbol: CP15_ReadDFSR
   Definitions
      At line 205 in file cp15_init.s
   Uses



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

      None
Comment: CP15_ReadDFSR unused
CP15_ReadDcacheLockdown 000001F0

Symbol: CP15_ReadDcacheLockdown
   Definitions
      At line 439 in file cp15_init.s
   Uses
      At line 69 in file cp15_init.s
Comment: CP15_ReadDcacheLockdown used once
CP15_ReadDomainAccessControl 0000008C

Symbol: CP15_ReadDomainAccessControl
   Definitions
      At line 171 in file cp15_init.s
   Uses
      At line 50 in file cp15_init.s
Comment: CP15_ReadDomainAccessControl used once
CP15_ReadFAR 000000E8

Symbol: CP15_ReadFAR
   Definitions
      At line 233 in file cp15_init.s
   Uses
      None
Comment: CP15_ReadFAR unused
CP15_ReadFCSE_PID 0000028C

Symbol: CP15_ReadFCSE_PID
   Definitions
      At line 533 in file cp15_init.s
   Uses
      At line 79 in file cp15_init.s
Comment: CP15_ReadFCSE_PID used once
CP15_ReadID 00000000

Symbol: CP15_ReadID
   Definitions
      At line 93 in file cp15_init.s
   Uses
      At line 40 in file cp15_init.s
Comment: CP15_ReadID used once
CP15_ReadIFSR 000000D4

Symbol: CP15_ReadIFSR
   Definitions
      At line 214 in file cp15_init.s
   Uses
      None
Comment: CP15_ReadIFSR unused
CP15_ReadIcacheLockdown 00000224

Symbol: CP15_ReadIcacheLockdown
   Definitions
      At line 456 in file cp15_init.s
   Uses
      At line 71 in file cp15_init.s
Comment: CP15_ReadIcacheLockdown used once
CP15_ReadTCMStatus 00000018



ARM Macro Assembler    Page 4 Alphabetic symbol ordering
Relocatable symbols


Symbol: CP15_ReadTCMStatus
   Definitions
      At line 105 in file cp15_init.s
   Uses
      At line 42 in file cp15_init.s
Comment: CP15_ReadTCMStatus used once
CP15_ReadTLBLockdown 00000258

Symbol: CP15_ReadTLBLockdown
   Definitions
      At line 484 in file cp15_init.s
   Uses
      At line 73 in file cp15_init.s
      At line 76 in file cp15_init.s

CP15_ReadTTB 00000058

Symbol: CP15_ReadTTB
   Definitions
      At line 149 in file cp15_init.s
   Uses
      At line 47 in file cp15_init.s
Comment: CP15_ReadTTB used once
CP15_TestCleanInvalidateDcache 00000188

Symbol: CP15_TestCleanInvalidateDcache
   Definitions
      At line 327 in file cp15_init.s
   Uses
      At line 57 in file cp15_init.s
      At line 329 in file cp15_init.s

CP15_WaitForInterrupt 000001A8

Symbol: CP15_WaitForInterrupt
   Definitions
      At line 368 in file cp15_init.s
   Uses
      At line 60 in file cp15_init.s
Comment: CP15_WaitForInterrupt used once
CP15_WriteControl 00000030

Symbol: CP15_WriteControl
   Definitions
      At line 124 in file cp15_init.s
   Uses
      At line 45 in file cp15_init.s
Comment: CP15_WriteControl used once
CP15_WriteDcacheLockdown 000001FC

Symbol: CP15_WriteDcacheLockdown
   Definitions
      At line 444 in file cp15_init.s
   Uses
      At line 70 in file cp15_init.s
Comment: CP15_WriteDcacheLockdown used once
CP15_WriteDomainAccessControl 00000098




ARM Macro Assembler    Page 5 Alphabetic symbol ordering
Relocatable symbols

Symbol: CP15_WriteDomainAccessControl
   Definitions
      At line 176 in file cp15_init.s
   Uses
      At line 51 in file cp15_init.s
Comment: CP15_WriteDomainAccessControl used once
CP15_WriteFCSE_PID 00000298

Symbol: CP15_WriteFCSE_PID
   Definitions
      At line 538 in file cp15_init.s
   Uses
      At line 80 in file cp15_init.s
Comment: CP15_WriteFCSE_PID used once
CP15_WriteIFSR 000000E0

Symbol: CP15_WriteIFSR
   Definitions
      At line 219 in file cp15_init.s
   Uses
      None
Comment: CP15_WriteIFSR unused
CP15_WriteIcacheLockdown 00000230

Symbol: CP15_WriteIcacheLockdown
   Definitions
      At line 461 in file cp15_init.s
   Uses
      At line 72 in file cp15_init.s
Comment: CP15_WriteIcacheLockdown used once
CP15_WriteTLBLockdown 00000264

Symbol: CP15_WriteTLBLockdown
   Definitions
      At line 489 in file cp15_init.s
   Uses
      At line 74 in file cp15_init.s
      At line 77 in file cp15_init.s

CP15_WriteTTB 00000064

Symbol: CP15_WriteTTB
   Definitions
      At line 154 in file cp15_init.s
   Uses
      At line 48 in file cp15_init.s
Comment: CP15_WriteTTB used once
CP15_writeDFSR 000000CC

Symbol: CP15_writeDFSR
   Definitions
      At line 210 in file cp15_init.s
   Uses
      None
Comment: CP15_writeDFSR unused
CP15_writeFAR 000000F4

Symbol: CP15_writeFAR
   Definitions



ARM Macro Assembler    Page 6 Alphabetic symbol ordering
Relocatable symbols

      At line 238 in file cp15_init.s
   Uses
      None
Comment: CP15_writeFAR unused
cp15 00000000

Symbol: cp15
   Definitions
      At line 30 in file cp15_init.s
   Uses
      None
Comment: cp15 unused
38 symbols
368 symbols in table
